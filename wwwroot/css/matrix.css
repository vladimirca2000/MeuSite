:root {
  --matrix-bg: #000000;
  --matrix-dark-green: #001100;
  --matrix-green: #00ff41;
  --matrix-green-2: #00d934;
  --matrix-bright: #b7ffb7;

  /* sizing tokens (relative units) */
  --panel-radius: 0.75rem; /* ~12px */
  --modal-radius: 0.75rem; /* ~12px */
  --close-size: 2.5rem; /* ~40px */
  --panel-padding: clamp(1rem, 2.2vw, 1.6rem);
  --pill-area-w: 6%; /* relative width for clickable areas */
  --pill-area-h: 8%; /* relative height */
  --pill-left-offset: 10%; /* left offset as % */
  --pill-top-offset: 40%; /* top offset as % */
  --pill-right-offset: 10%; /* right offset as % */
}

html, body, .matrix-root {
  height: 100%;
  margin: 0;
  background: var(--matrix-bg);
  overflow: hidden;
  font-family: monospace, "Courier New", monospace;
  font-size: 16px; /* base for rem */
}

.matrix-root {
  position: relative;
  width: 100%;
  height: 100%;
}

canvas#matrix-canvas {
  position: fixed;
  inset: 0; /* top:0; right:0; bottom:0; left:0; */
  width: 100vw;
  height: 100vh;
  display: block;
  z-index: 0;
  background: linear-gradient(180deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0.85) 100%);
}

/* overlay content (central panel) */
.matrix-overlay {
  position: fixed;
  inset: 0;
  z-index: 2;
  color: var(--matrix-bright);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.matrix-panel {
  background: rgba(0, 0, 0, 0.55);
  border: 0.125rem solid rgba(0, 255, 65, 0.20); /* 2px ~ 0.125rem */
  box-shadow: 0 0.625rem 2.5rem rgba(0, 255, 65, 0.08), 0 0 1.125rem rgba(0, 255, 65, 0.08) inset;
  padding: var(--panel-padding);
  border-radius: var(--panel-radius);
  max-width: 42.5rem; /* ~680px */
  width: min(92%, 42.5rem);
  backdrop-filter: blur(0.375rem); /* ~6px */
  text-align: center;
  pointer-events: auto;
}

.matrix-panel h1 {
  margin: 0 0 0.4rem 0;
  color: var(--matrix-green);
  font-size: clamp(1.25rem, 2.4vw, 2.2rem);
  text-shadow: 0 0 0.5rem rgba(0,255,80,0.22), 0 0 1.125rem rgba(0,255,120,0.04);
  /* remove focus outline */
  outline: none;
  user-select: none;
  pointer-events: none;
}

.matrix-panel p {
  margin: 0 0 1rem 0;
  color: rgba(183,255,183,0.9);
  font-size: clamp(0.95rem, 1.6vw, 1rem);
  /* remove focus outline */
  outline: none;
  user-select: none;
  pointer-events: none;
}

.matrix-btn {
  appearance: none;
  -webkit-appearance: none;
  border: none;
  background: linear-gradient(180deg, var(--matrix-green), var(--matrix-green-2));
  color: #fff;
  padding: clamp(0.6rem, 1.2vw, 0.9rem) clamp(1rem, 2.2vw, 1.4rem);
  font-weight: 700;
  font-size: clamp(0.95rem, 1.6vw, 1.05rem);
  border-radius: 0.625rem; /* ~10px */
  cursor: pointer;
  box-shadow: 0 0.5rem 1.375rem rgba(0,255,65,0.12), 0 0 0.5rem rgba(0,255,65,0.07);
  transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
}

.matrix-btn:hover { transform: translateY(-0.125rem); filter: brightness(1.06); }
.matrix-btn:active { transform: translateY(0); }
.matrix-btn:focus { outline: 0.1875rem solid rgba(0,255,65,0.14); outline-offset: 0.1875rem; }
.matrix-btn.clicked { transform: translateY(-0.0625rem) scale(1.01); filter: brightness(1.08); }

/* Modal styles */
.matrix-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.6);
  opacity: 0;
  visibility: hidden;
  transition: opacity 240ms ease, visibility 240ms ease;
  z-index: 9999;
}

.matrix-modal.open { opacity: 1; visibility: visible; }

.matrix-modal-content {
  position: relative;
  /* fully responsive: use viewport units for max adaptability */
  width: min(95vw, 90rem); /* up to 95% of viewport width, max 90rem */
  height: min(85vh, 50rem); /* up to 85% of viewport height, max 50rem */
  aspect-ratio: 16 / 9; /* maintain proportional aspect ratio to prevent distortion */
  border-radius: var(--modal-radius);
  /* background handled by a responsive <img> element (.matrix-modal-bg) */
  box-shadow: 0 1.125rem 3rem rgba(0,0,0,0.6), inset 0 0 3.75rem rgba(0,0,0,0.16);
  border: 0.125rem solid rgba(0,255,65,0.12);
  overflow: hidden;
  display: flex;
  align-items: flex-start; /* place inner content at top */
}

.matrix-modal-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none; /* let clicks through to areas above */
  display: block;
}
.matrix-modal-img img {
  width: 100%;
  height: 100%;
  object-fit: contain; /* show entire image, maintaining aspect ratio, with letterboxing if needed */
  object-position: center;
  display: block;
}

/* ensure modal inner content sits above the background image */
.matrix-modal .modal-inner { z-index: 1; position: relative; }
.matrix-modal .modal-close { z-index: 2; }

.matrix-modal .modal-close {
  position: absolute;
  top: 0.75rem; /* ~12px */
  right: 0.75rem;
  background: rgba(0,0,0,0.48);
  color: #fff;
  border: none;
  width: var(--close-size);
  height: var(--close-size);
  border-radius: 0.625rem;
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0.375rem 1.125rem rgba(0,255,65,0.08);
}
.matrix-modal .modal-close:hover { filter: brightness(1.08); }

.matrix-modal .modal-inner {
  width: 100%;
  padding: clamp(1rem, 2.4vw, 1.6rem);
  background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.65) 60%);
  color: var(--matrix-bright);
  text-align: center;
}

.matrix-modal .modal-inner h2 {
  margin: 0 0 0.4rem 0;
  color: var(--matrix-green);
  font-size: clamp(1rem, 2.2vw, 1.6rem);
  text-shadow: 0 0 0.375rem rgba(0,255,80,0.18);
}

.matrix-modal .modal-inner p {
  margin: 0 0 0.6rem 0;
  color: rgba(183,255,183,0.95);
  font-size: clamp(0.95rem, 1.6vw, 1rem);
}

/* modal content animation */
.matrix-modal .matrix-modal-content { transform: translateY(-0.5rem); opacity: 0; transition: opacity 340ms ease, transform 340ms cubic-bezier(.2,.9,.2,1); }
.matrix-modal.open .matrix-modal-content { transform: translateY(0); opacity: 1; }

/* Expanded panel styles */
.matrix-expanded-panel {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10;
  opacity: 0;
  transition: opacity 300ms ease;
}

.matrix-expanded-panel.open {
  opacity: 1;
}

.expanded-content {
  position: relative;
  width: auto; /* adjust to content width */
  max-width: min(95vw, 90rem); /* max width to fit screen */
  height: auto; /* adjust to content height */
  max-height: min(85vh, 50rem); /* max height to fit screen */
  border-radius: var(--modal-radius);
  box-shadow: 0 1.125rem 3rem rgba(0,0,0,0.6), inset 0 0 3.75rem rgba(0,0,0,0.16);
  border: 0.125rem solid rgba(0,255,65,0.12);
  overflow: hidden;
  display: flex;
  flex-direction: column; /* stack text on top, image below */
}

.expanded-img {
  width: 100%;
  height: auto; /* adjust to maintain aspect ratio */
  max-height: 100%; /* ensure it fits */
  object-fit: contain;
  object-position: center;
  display: block;
  flex: 1; /* take remaining space */
  z-index: 0;
}

.expanded-inner {
  padding: clamp(1rem, 2.4vw, 1.6rem);
  background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
  color: var(--matrix-bright);
  text-align: center;
  /* position: static; no longer absolute */
  z-index: 1;
}

.expanded-inner h2 {
  margin: 0 0 0.4rem 0;
  color: var(--matrix-green);
  font-size: clamp(1rem, 2.2vw, 1.6rem);
  text-shadow: 0 0 0.375rem rgba(0,255,80,0.18);
}

.expanded-inner p {
  margin: 0;
  color: rgba(183,255,183,0.95);
  font-size: clamp(0.95rem, 1.6vw, 1rem);
}

.expanded-close {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  background: rgba(0,0,0,0.48);
  color: #fff;
  border: none;
  width: var(--close-size);
  height: var(--close-size);
  border-radius: 0.625rem;
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0.375rem 1.125rem rgba(0,255,65,0.08);
  z-index: 2;
}

.expanded-close:hover { filter: brightness(1.08); }

/* clickable areas positioned over the image */
.pill-area { position: absolute; cursor: pointer; background: transparent; border-radius: 999px; border: 0.0625rem solid rgba(255,255,255,0.02); transition: box-shadow 150ms ease, transform 120ms ease; display: inline-block; z-index: 1; }
.pill-area:focus { outline: none; box-shadow: 0 0 0 0.25rem rgba(0,255,65,0.06); }

/* positions in % relative to the image container */
.pill-left { left: 10%; top: 40%; width: 6%; height: 8%; }
.pill-left:hover { box-shadow: 0 0.375rem 1.625rem rgba(255, 82, 82, 0.28); }
.pill-right { right: 10%; top: 40%; width: 6%; height: 8%; }
.pill-right:hover { box-shadow: 0 0.375rem 1.625rem rgba(25,118,210,0.28); }

/* Área clicável da pílula azul */
.blue-pill-area {
  position: absolute;
  left: 64%;
  top: 31%;
  width: 6%;
  height: 19%;
  /* outros estilos mantidos */
}

/* Área clicável da pílula vermelha */
.red-pill-area {
  position: absolute;
  left: 26%;
  top: 41%;
  width: 7%;
  height: 13%;
  /* outros estilos mantidos */
}

@media (max-width: 640px) {
  .expanded-content { max-height: 90vh; border-radius: 0.625rem; }
  .expanded-close { width: 2.25rem; height: 2.25rem; }
  /* mobile adjustments: adjust positions */
  .expanded-img { object-position: 50% 45%; }
  .pill-left { left: 15%; top: 50%; width: 8%; height: 10%; }
  .pill-right { right: 15%; top: 50%; width: 8%; height: 10%; }
}

/* small-screen tweaks */
@media (max-width: 420px) {
  .matrix-panel { border-radius: 0.625rem; padding: 1rem; }
  .matrix-btn { width: 100%; }
}
